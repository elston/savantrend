// Generated by CoffeeScript 1.10.0
(function() {
  'use strict';
  var formatDate, formatExamples;

  formatDate = function(text, time) {
    if (!time) {
      time = new Date();
    }
    if (typeof time !== 'string') {
      time = time.toISOString();
    }
    if (!text) {
      text = '';
    }
    return $.ajax({
      url: '/format-date/',
      type: 'POST',
      data: JSON.stringify({
        'time': time,
        'text': text
      }),
      contentType: 'application/json; charset=utf-8',
      dataType: 'json'
    });
  };

  formatExamples = function() {
    $('*[data-date-format-example-for]').each(function() {
      var errorClass, errorTarget, handler, target, that;
      that = $(this);
      target = $('#' + that.data('date-format-example-for'));
      errorClass = that.data('date-format-example-error-class');
      errorTarget = $('#' + that.data('date-format-example-error-target'));
      if (errorTarget.length === 0) {
        errorTarget = that;
      }
      handler = function() {
        return formatDate($(this).val()).then(_.throttle(function(data) {
          that.html(JSON.parse(data));
          if (errorClass) {
            return errorTarget.removeClass(errorClass);
          }
        }, 400), function(jqXHR, textStatus, errorThrown) {
          that.html('Invalid date format.');
          if (errorClass) {
            return errorTarget.addClass(errorClass);
          }
        });
      };
      target.on('keyup change', handler);
      return handler.bind(target)();
    });
    return null;
  };

  window.formatExamples = formatExamples;

}).call(this);
