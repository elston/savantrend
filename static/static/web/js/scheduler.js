// Generated by CoffeeScript 1.10.0
(function() {
  'use strict';
  $(function() {
    if ($('.scheduler_main').length > 0) {
      $('.row.inprogress').addClass('hidden');
      $('.scheduler_main').removeClass('hidden');
      $(document).on('click', '.open-report', function() {
        var getparams, report_url, urlparams;
        urlparams = $(this).data('urlparams');
        urlparams['open_report'] = true;
        report_url = urlparams['reporturl'];
        delete urlparams['reporturl'];
        getparams = $.param(urlparams);
        report_url = report_url + "?" + getparams;
        window.location = report_url;
        return true;
      });
      $(document).on('click', '.schedit', function() {
        var detailsurl;
        detailsurl = $(this).closest('tr').data('detailsurl');
        $.ajax(detailsurl, {
          type: 'GET',
          dataType: 'html',
          data: {},
          success: function(data, textStatus, jqXHR) {
            var modal;
            if (data !== 'OK') {
              modal = $(data).modal('show');
              return ScheduleReportOpen(modal);
            }
          }
        });
        return true;
      });
      $(document).on('click', '.emailreportscheduledelete', function() {
        var modal, params, post_url, scheduleid;
        if (!confirm('Are you sure you want to delete this item?')) {
          return false;
        }
        modal = $(this).closest('.modal');
        scheduleid = $('#scheduleinfo_data', modal).data('scheduleid');
        post_url = $('#scheduleinfo_data', modal).data('taskposturl') || '';
        params = {
          'delete_schreport': true
        };
        $.ajax(post_url, {
          type: 'POST',
          dataType: 'html',
          data: $.param(params),
          success: function(data, textStatus, jqXHR) {
            var close, message;
            if (data !== 'OK') {
              alert(data);
            } else {
              $(modal).modal('hide');
              message = $('<div class="alert alert-success success-message" style="display: none;"></div>');
              close = $('<button type="button" class="close" data-dismiss="alert">&times</button>');
              message.append(close);
              message.append("This report has been deleted");
              message.appendTo($('body>div.container')).fadeIn(300).delay(3000).fadeOut(500);
              if (typeof navigate !== "undefined" && navigate !== null) {
                navigate($('.paginated_content'));
              }
            }
            return true;
          }
        });
        return true;
      });
      window.get_params = function() {
        var filter_data;
        filter_data = {};
        return filter_data;
      };
    }
    $('#delallreports').click(function() {
      var deleteurl;
      if (confirm('Are you sure you want to delete all reports?')) {
        deleteurl = $(this).data('deleteurl');
        $.ajax(deleteurl, {
          type: 'POST',
          dataType: 'html',
          data: $.param({
            delete_all_reports: true
          }),
          success: function(data, textStatus, jqXHR) {
            if (data !== 'OK') {
              return alert(data);
            } else {
              return window.location = window.location;
            }
          }
        });
        return true;
      }
      return false;
    });
    if ($('.reportfilter,.scheduler_main').length > 0) {
      window.schedulerTabSwitch = function(target, modal) {
        $('.nav.schedule-setup li', modal).removeClass('active');
        $('.nav.schedule-setup a', modal).each(function() {
          var etarg;
          etarg = $(this).data('target');
          $("." + etarg, modal).hide();
          return true;
        });
        $("." + target, modal).show();
        $('.nav.schedule-setup a[data-target="' + target + '"]', modal).parent().addClass('active');
        return true;
      };
      window.ScheduleReportOpen = function(modal) {
        $('.schedule-setup', modal).removeClass('hidden');
        $('.email-setup:not(.hidden)', modal).addClass('hidden');
        schedulerTabSwitch('emailinfo', modal);
        $('#firstday', modal).datepicker({
          showISOWeekNumbers: true,
          autoApply: true,
          autoclose: true,
          todayBtn: 'linked',
          todayHighlight: true,
          minViewMode: 'days',
          maxViewMode: 'years',
          format: 'mm/dd/yyyy',
          opens: "right"
        });
        $('#deliveryhour', modal).select2({
          minimumResultsForSearch: Infinity
        });
        $('#deliveryhourmin', modal).select2({
          minimumResultsForSearch: Infinity
        });
        return true;
      };
      $('#btnScheduleReport').click(function() {
        var modal;
        modal = $('#mdlEmailReport').modal('show');
        ScheduleReportOpen(modal);
        return true;
      });
      $(document).on('change', '.modal .sch-period input:radio', function() {
        var modal, period;
        modal = $(this).closest('.modal');
        period = $(this).data('period');
        $('.sch-period-details:not(.hidden)').addClass('hidden');
        return $('.sch-period-' + period).removeClass('hidden');
      });
      $(document).on('click', 'button.emailreportschedule', function() {
        var modal, params, post_url, scheduleid;
        modal = $(this).closest('.modal');
        scheduleid = $('#scheduleinfo_data', modal).data('scheduleid');
        post_url = $('#scheduleinfo_data', modal).data('taskposturl') || '';
        params = get_params();
        params['schedule_id'] = scheduleid;
        params['report_id'] = $('#scheduleinfo_data', modal).data('reportid');
        params['emailto'] = $('#emailto', modal).val();
        params['emailcc'] = $('#emailcc', modal).val();
        params['emailbcc'] = $('#emailbcc', modal).val();
        params['emailsubject'] = $('#emailsubject', modal).val();
        params['emailbody'] = $('#emailbody', modal).val();
        params['formats'] = [];
        $('.emailexport_type:checked', modal).each(function() {
          params['formats'].push($(this).data('format'));
          return true;
        });
        params['dayoffset'] = $('#dayoffset', modal).val();
        params['firstday'] = $('#firstday', modal).val();
        params['deliveryhour'] = $('#deliveryhour', modal).val();
        params['deliveryhourmin'] = $('#deliveryhourmin', modal).val();
        params['schperiod'] = $('.sch-period input:radio:checked', modal).data('period');
        params['schperioddaily'] = [];
        $('.schperioddaily:checked', modal).each(function() {
          params['schperioddaily'].push($(this).data('day'));
          return true;
        });
        $.ajax(post_url, {
          type: 'POST',
          dataType: 'html',
          data: $.param(params),
          success: function(data, textStatus, jqXHR) {
            var close, message;
            if (data !== 'OK') {
              alert(data);
            } else {
              $(modal).modal('hide');
              message = $('<div class="alert alert-success success-message" style="display: none;"></div>');
              close = $('<button type="button" class="close" data-dismiss="alert">&times</button>');
              message.append(close);
              message.append("This report has been scheduled");
              message.appendTo($('body')).fadeIn(300).delay(3000).fadeOut(500);
              if (typeof navigate !== "undefined" && navigate !== null) {
                navigate($('.paginated_content'));
              }
            }
            return true;
          }
        });
        return true;
      });
      $(document).on('click', '.nav.schedule-setup a', function() {
        var modal, target;
        target = $(this).data('target');
        modal = $(this).closest('.modal');
        schedulerTabSwitch(target, modal);
        return false;
      });
    }
    return true;
  });

}).call(this);
